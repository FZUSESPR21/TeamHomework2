<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>小组评分表</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="../layui/css/layui.css">
    <script src="../layui/layui.js" type="text/javascript" charset="utf-8"></script>
    <script src="../js/select.js" type="text/javascript" charset="utf-8"></script>
    <script src="../js/option.js" type="text/javascript" charset="utf-8"></script>
    <script src="../js/sidebarnavigation.js" type="text/javascript" charset="utf-8"></script>
    <script src="../js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="../bootstrap-table/dist/bootstrap-table.min.css">
    <link rel="stylesheet" href="../css/table.css">
    <script src="https://cdn.staticfile.org/jquery/2.1.1/jquery.min.js"></script>
    <script src="http://cdn.bootcss.com/bootstrap/3.3.0/js/bootstrap.min.js"></script>
    <script src="https://cdn.bootcss.com/bootstrap-table/1.15.4/bootstrap-table.min.js"></script>
    <script src="https://cdn.bootcss.com/bootstrap-table/1.15.4/locale/bootstrap-table-zh-CN.min.js"></script>
    <link rel="stylesheet" href="../css/snstyle.css">
    <link rel="stylesheet" href="../css/popup.css">
</head>
<body>
<div>
    <div class="clear">
        <ul class="layui-nav">
            <li class="layui-nav-item layui-this" id="manage-content">
                <a onclick="manageClicked()">内容管理<span class="layui-nav-item"></span></a>
            </li>
            <li class="layui-nav-item">
                <a onclick="userClicked()">用户管理<span class="layui-nav-item"></span></a>
            </li>
            <li class="layui-nav-item">
                <a onclick="analysisClicked()">统计分析<span class="layui-nav-item"></span></a>
            </li>
            <li class="layui-nav-item" id="my-message">
                <a href=""><img src="//t.cn/RCzsdCq" class="layui-nav-img">我</a>
                <dl class="layui-nav-child">
                    <dd><a href="javascript:;">修改信息</a></dd>
                    <dd><a href="javascript:;">退出</a></dd>
                </dl>
            </li>
        </ul>
        <div class="sidebar">
            <ul class="layui-nav layui-nav-tree" lay-filter="test" lay-shrink="all" id="content-manage">
                <!-- 侧边导航: <ul class="layui-nav layui-nav-tree layui-nav-side"> -->
                <li class="layui-nav-item">
                    <a href="javascript:;">评分细则管理</a>
                    <dl class="layui-nav-child">
                        <dd><a href="jobManagemant/showdetails.html">所有细则</a></dd>
                        <dd><a href="jobManagemant/newdetails.html">增加细则</a></dd>
                    </dl>
                </li>
                <li class="layui-nav-item layui-nav-itemed">
                    <a href="javascript:;">成绩管理</a>
                    <dl class="layui-nav-child">
                        <dd><a href="scoreinquiry.html">成绩查询</a></dd>
                        <dd><a href="assignmentScore.html">博客评分</a></dd>
                        <dd><a href="defensescore.html">答辩评分</a></dd>
                        <dd><a href="blogList.html">博客列表</a></dd>
                    </dl>
                </li>
            </ul>

            <ul class="layui-nav layui-nav-tree" lay-filter="test" lay-shrink="all" id="user-manage">
                <!-- 侧边导航: <ul class="layui-nav layui-nav-tree layui-nav-side"> -->
                <li class="layui-nav-item">
                    <a href="javascript:;">团队管理</a>
                    <dl class="layui-nav-child">
                        <dd><a href="">所有团队</a></dd>
                        <dd><a href="javascript:;">增加团队</a></dd>
                    </dl>
                </li>
                <li class="layui-nav-item">
                    <a href="javascript:;">结对管理</a>
                    <dl class="layui-nav-child">
                        <dd><a href="javascript:;">结对信息</a></dd>
                        <dd><a href="">增加结对</a></dd>
                    </dl>
                </li>
                <li class="layui-nav-item layui-nav-itemed">
                    <a href="javascript:;">学生管理</a>
                    <dl class="layui-nav-child">
                        <dd><a href="javascript:;">学生列表</a></dd>
                        <dd><a href="">增加学生</a></dd>
                    </dl>
                </li>
            </ul>

            <ul class="layui-nav layui-nav-tree" lay-filter="test" lay-shrink="all" id="statistical-analysis">
                <!-- 侧边导航: <ul class="layui-nav layui-nav-tree layui-nav-side"> -->
                <li class="layui-nav-item  layui-nav-itemed">
                    <a href="javascript:;">统计分析</a>
                    <dl class="layui-nav-child">
                        <dd><a href="">千帆竟发图</a></dd>
                    </dl>
                </li>
            </ul>
        </div>
    </div>
    <!--将各个部分代码填在以下div内-->
    <div class="page-wrapper">
        <table id="myTable" class="table table-hover text-nowrap"></table>
    </div>
</div>
<div id="container">
    <div id="hidden"></div>
    <div id="box">
        <strong id="close">关闭</strong>
        <span>输入答辩评分：<input id="defense_score" type="text" placeholder="输入分数" onkeyup="if(isNaN(value))execCommand('undo')" onafterpaste="if(isNaN(value))execCommand('undo')"></span>
        <input type="button" value="提交" id="submit" onclick="editInfo()">
        <!--        <button id="submit">提交</button>-->
    </div>
</div>

<script>
    var open = document.getElementById('open');
    var box = document.getElementById('box');
    var hidden = document.getElementById('hidden');
    var close = document.getElementById('close');
    var itemId;
    var itemScore;
    $('#myTable').bootstrapTable({
        method: 'get',
        url: "test1.json", // 请求路径
        striped: true, // 是否显示行间隔色
        pageNumber: 1, // 初始化加载第一页
        pagination: true, // 是否分页
        sidePagination: 'client', // server:服务器端分页|client：前端分页
        height:600,
        sortable: true,
        // search: true,
        showColumns: true, //筛选要显示的列
        // showSearchClearButton: true, //显示搜索清除按钮
        pageSize: 10, // 单页记录数

        paginationLoop: true,
        paginationHAlign: 'left',
        paginationDetailHAlign: 'right',
        paginationPreText: '上一页',
        paginationNextText: '下一页',

        columns: [{
            title: '评分项号',
            field: 'id',
            sort: true,
            sortable: true,
            searchable:true,
        }, {
            title: '评分项',
            field: 'name',
            sort: true,
            sortable: true,
            searchable:true,
        }, {
            title: '分值',
            field: 'score',
            sort: true,
            sortable: true,
            searchable:true,
        }, {
            title: '得分',
            field: 'std_score',
            sortable: true,
            formatter: function (value, row, index) {
                if (value == null || value == undefined) {
                    return "";
                } else {
                    return value;
                }
            }
        }, {
            //field: 'operate',
            title: '操作',
            align: 'center',
            valign: 'middle',
            events: {
                'click #edit': function (e, value, row, index) {
                    itemId = row.id;
                    itemScore = row.score;
                    $('#defense_score').val(row.std_score);
                    $("#defense_score").attr("oninput","if(value>"+itemScore+")value="+itemScore)
                    box.style.display = 'flex';
                    hidden.style.display = 'block';
                },
            },
            formatter: function (value, row, index) {
                var result = "";
                result += '<button id="edit" class="btn btn-info" data-toggle="modal" data-target="#editModal">评分</button>';
                return result;
            }
        }
        ]
    })

    //关闭
    close.onclick = function () {
        box.style.display = 'none';
        hidden.style.display = 'none';
        // 关闭后恢复box到原来的默认位置
        box.style.top = '200px';
        box.style.marginRight = '100%';
    }

    function getPage(e) {
        var pageX = e.pageX || e.clientX + getScroll().scrollLeft;
        var pageY = e.pageY || e.clientY + getScroll().scrollTop;
        return {
            pageX: pageX,
            pageY: pageY
        }
    }

    box.onmousedown = function (e) {
        e = e || window.event;
        // 盒子的位置
        var x = getPage(e).pageX - box.offsetLeft;
        var y = getPage(e).pageY - box.offsetTop;
        document.onmousemove = function (e) {
            e = e || window.event;
            box.style.left = getPage(e).pageX - x + 'px';
            box.style.top = getPage(e).pageY - y + 'px';
        }
    }

    document.onmouseup = function () {
        document.onmousemove = null;
    }

    // 修改信息
    function editInfo() {
        $.ajax({
            type: 'post',
            url: 'test.json',
            dataType: 'json',
            beforeSend: function (XMLHttpRequest) {
                XMLHttpRequest.setRequestHeader("token", localStorage.token);
            },
            data: {
                itemId: itemId,
                defense_score: $('#defense_score').val(),   //.val获取value值，而.html获取标签内的所有内容
            },
            success: function (data) {
                if (data == 'Yes') {
                    $('#myTable').bootstrapTable('refresh');
                    $('#editModal').modal('hide');
                }
                else {
                    alert('修改失败');
                }
            }
        });
        close.click();
    }
</script>


</body>
</html>