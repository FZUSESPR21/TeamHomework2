<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>作业提交</title>
    <link rel="stylesheet" href="../css/bootstrap.css" media="all">
    <link rel="stylesheet" href="../layui/css/layui.css">
    <script src="../layui/layui.js" type="text/javascript" charset="utf-8"></script>
    <script src="../js/select.js" type="text/javascript" charset="utf-8"></script>
    <script src="../js/option.js" type="text/javascript" charset="utf-8"></script>
    <script src="../js/sidebarnavigation.js" type="text/javascript" charset="utf-8"></script>
    <script src="../js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="../css/snstyle.css">
    <script src="../jquery/dist/jquery.min.js"></script>
    <script src="../js/token-operation.js"></script>
    <link rel="stylesheet" href="../layui/css/layui.css" media="all">
    <link rel="stylesheet" href="../css/assignmentSubmit.css" media="all">
</head>
<body>
<div>
    <ul class="layui-nav">
        <li class="layui-nav-item layui-this" id="manage-content">
            <a onclick="manageClicked()">内容管理<span class="layui-nav-item"></span></a>
        </li>
        <li class="layui-nav-item">
            <a onclick="analysisClicked()">统计分析<span class="layui-nav-item"></span></a>
        </li>
        <li class="layui-nav-item" id="my-message">
            <a href=""><img src="//t.cn/RCzsdCq" class="layui-nav-img">我</a>
            <dl class="layui-nav-child">
                <dd><a href="javascript:;">修改信息</a></dd>
                <dd><a href="javascript:;">退出</a></dd>
            </dl>
        </li>
    </ul>

    <div class="sidebar">
        <ul class="layui-nav layui-nav-tree" lay-filter="test" lay-shrink="all" id="content-manage">
            <!-- 侧边导航: <ul class="layui-nav layui-nav-tree layui-nav-side"> -->

            <li class="layui-nav-item layui-nav-itemed">
                <a href="javascript:;">成绩管理</a>
                <dl class="layui-nav-child">
                    <dd><a href="javascript:;">成绩查询</a></dd>
                    <dd><a href="">答辩评分</a></dd>
                    <dd><a href="">作业提交</a></dd>
                </dl>
            </li>
        </ul>

        <ul class="layui-nav layui-nav-tree" lay-filter="test" lay-shrink="all" id="statistical-analysis">
            <!-- 侧边导航: <ul class="layui-nav layui-nav-tree layui-nav-side"> -->
            <li class="layui-nav-item  layui-nav-itemed">
                <a href="javascript:;">统计分析</a>
                <dl class="layui-nav-child">
                    <dd><a href="">千帆竟发图</a></dd>
                </dl>
            </li>
        </ul>
    </div>

    <!--将各个部分代码填在以下div内-->
    <div class="page-wrapper">
        <div id="message_form">
            <div>

                <div class="input-group">
                    <span>作业：</span>
                    <select id="work_type" name="work_type" class="layui-select">
                        <option value="1">个人作业</option>
                        <option value="2">结对作业</option>
                        <option value="3">团队作业</option>
                    </select>

                    <select id="work" name="work" class="layui-select">
                    </select>

                    <div id="work_name">
                        <span class="input-group-addon">博客标题:</span>
                        <label>
                            <input id="blog_work_name" name="blog_work_name" type="text" class="form-control" placeholder="请输入博客标题" aria-describedby="basic-addon1">
                        </label>
                    </div>
                </div>

                <div class="layui-form-item layui-form-text" id="blog_form">
                    <label>博客内容:</label>
                    <div class="layui-input-block">
                        <label>
                            <textarea id="blog_content" name="checklist" placeholder="请输入博客内容" class="layui-textarea"></textarea>
                        </label>
                    </div>
                </div>

                <div class="input-group">
                    <div>
                        <span class="input-group-addon">博客链接：</span>
                        <label>
                            <input id="blog_link" name="blog_link" type="text" class="form-control" placeholder="请输入博客链接" aria-describedby="basic-addon1">
                        </label>
                    </div>

                    <select id="team" name="team" class="layui-select">
                    </select>

                    <div id="personal_id">
                        <div class="input_student_id">
                            <span class="input-group-addon">你的学号：</span>
                            <label>
                                <input id="student" name="student" type="text" class="form-control" placeholder="请输入你的学号" aria-describedby="basic-addon1">
                            </label>
                        </div>
                    </div>


                    <div id="pair_member">
                        <div class="input_student_id">
                            <span class="input-group-addon">你的学号：</span>
                            <label>
                                <input id="student1" name="student1" type="text" class="form-control" placeholder="请输入你的学号" aria-describedby="basic-addon1">
                            </label>
                        </div>
                        <div class="input_student_id">
                            <span class="input-group-addon">队友学号：</span>
                            <label>
                                <input id="student2" name="student2" type="text" class="form-control" placeholder="请输入队友学号" aria-describedby="basic-addon1">
                            </label>
                        </div>
                    </div>
                </div>

                <button id="submit_button" class="layui-btn" onclick="submitOnClicked()">提交</button>
            </div>
        </div>
    </div>
</div>
<div id="container">
    <div id="hidden"></div>
    <div id="box">
        <strong id="close">关闭</strong>
        <span id="hint">输入成员贡献度</span>
    </div>
</div>

<script>
    var open = document.getElementById('open');
    var box = document.getElementById('box');
    var hidden = document.getElementById('hidden');
    var close = document.getElementById('close');
    var i = 1;

    close.onclick = function () {
        box.style.display = 'none';
        hidden.style.display = 'none';
        // 关闭后恢复box到原来的默认位置
    };

    $(document).ready(function () {
        //加载下拉列表的内容
        $.ajax({
            type: 'get',
            url: 'test1.json',
            dataType: 'json',
            success: function(data){
                $.each(data,function (index,item) {
                    if (data[index].work_id){
                        $("#work").append("<option value='"+data[index].work_id+"'>"+data[index].work_name+"</option>");
                    }
                });
            }
        });
    });

    //下拉选项改变时
    document.getElementById('work_type').onchange=function(){

        var work_type_id = $("#work_type").find("option:selected").val();
        if (work_type_id == 1){
            document.getElementById('team').style.display = 'none';
            document.getElementById('pair_member').style.display = 'none';
            document.getElementById('personal_id').style.display = 'block';
        }else if (work_type_id == 2){
            document.getElementById('team').style.display = 'none';
            document.getElementById('pair_member').style.display = 'block';
            document.getElementById('personal_id').style.display = 'none';
        }else {
            document.getElementById('pair_member').style.display = 'none';
            document.getElementById('team').style.display = 'block';
            document.getElementById('personal_id').style.display = 'none';
            $("#team").display = true;
            $.ajax({
                type: 'post',
                url: 'test3.json',
                dataType: 'json',
                data: {
                    work_type_id: work_type_id,
                },
                success: function(data){
                    $("#work option").remove();
                    $.each(data,function (index,item) {
                        if (data[index].work_id){
                            $("#work").append("<option value='"+data[index].work_id+"'>"+data[index].work_name+"</option>");
                        }
                        if (data[index].id){
                            $("#box").append("<span>" +data[index].id+": "+ "<input id='"+i+"' name='"+data[index].id+"' class=\"input\" type=\"text\" placeholder=\"输入分数\"\n" +
                                "onkeyup=\"if(isNaN(value))execCommand('undo')\" onafterpaste=\"if(isNaN(value))execCommand('undo')\">\n" +
                                "</span>");
                            i=i+1;
                        }
                    });
                    $("#box").append("<input type=\"button\" value=\"提交\" id=\"submit\" onclick=\"submitTeam()\">");
                }
            });
        }
    };




    function submitOnClicked() {
        var work_id = $("#work").find("option:selected").val();
        var work_type_id = $("#work_type").find("option:selected").val();
        var work_name = $("#work_name").val();
        var blog_content = $("#blog_content").val();
        var blog_link = $("#blog_link").val();
        var student_id = $("#student").val();
        var student_id1 = $("#student1").val();
        var student_id2 = $("#student2").val();
        var userId = getToken("id");
        // var team_id = $("#team").find("option:selected").val();
        if (work_type_id == 1){
            console.log(1);
            $.ajax({
                type: 'post',
                url: 'test3.json',
                dataType: 'json',
                data: {
                    taskId: work_id,
                    blogWorkContent: blog_content,
                    blogurl: blog_link,
                    userId: student_id,
                    blogWorkName: work_name
                },
                success: function(data){
                    if(data == 'Yes'){
                        alert("提交成功");
                    }
                }
            });
        }else if (work_type_id == 2){
            console.log(2);
            $.ajax({
                type: 'post',
                url: 'test2.json',
                dataType: 'json',
                data: {
                    taskId: work_id,
                    blogWorkContent: blog_content,
                    blogurl: blog_link,
                    userId: student_id1,
                    blogWorkName: work_name,
                    teammateId: student_id2,
                },
                success: function(data){
                    if(data == 'Yes'){
                        alert("提交成功");
                    }
                }
            });
        }else {
            console.log(3);
            box.style.display = 'flex';
            hidden.style.display = 'block';
        }
    }
    function submitTeam() {

        var work_id = $("#work").find("option:selected").val();
        var work_name = $("#blog_work_name").val();
        var blog_content = $("#blog_content").val();
        var blog_link = $("#blog_link").val();
        var userId = getToken("id");
        var t = 0;
        var contributionList = new Array();
        for (var m=1; m<i-1; m++){
            var k = document.getElementById(m.toString()).value;
            var j = document.getElementById(m.toString()).name;
            var data2={
                "account": j,
                "ratio": k
            };
            contributionList[t++] = data2;
        }
        console.log(contributionList);

        var data1={
            "userId": userId,
            "taskId": work_id,
            "blogWorkName": work_name,
            "blogWorkContent": blog_content,
            "blogurl": blog_link,
            "contributionList": contributionList,
        };

        var data = JSON.stringify(data1);
        console.log(data);
        $.ajax({
            type: 'post',
            url: 'test2.json',
            dataType: 'json',
            data: data,
            success: function(data){
                if(data == 'Yes'){
                    alert("提交成功");
                }
            }
        });

    }
</script>
</body>
</html>