<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>新增学生</title>
    <link rel="stylesheet" href="../layui/css/layui.css">
    <script src="../layui/layui.js" type="text/javascript" charset="utf-8"></script>
    <script src="../js/select.js" type="text/javascript" charset="utf-8"></script>
    <script src="../js/option.js" type="text/javascript" charset="utf-8"></script>
    <script src="../js/sidebarnavigation.js" type="text/javascript" charset="utf-8"></script>
    <script src="../js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="../bootstrap-table/dist/bootstrap-table.min.css">
    <link rel="stylesheet" href="../css/table.css">
    <script src="https://cdn.staticfile.org/jquery/2.1.1/jquery.min.js"></script>
    <script src="http://cdn.bootcss.com/bootstrap/3.3.0/js/bootstrap.min.js"></script>
    <script src="https://cdn.bootcss.com/bootstrap-table/1.15.4/bootstrap-table.min.js"></script>
    <script src="https://cdn.bootcss.com/bootstrap-table/1.15.4/locale/bootstrap-table-zh-CN.min.js"></script>
    <link rel="stylesheet" href="../css/snstyle.css">
    <link rel="stylesheet" href="../css/popup.css">
    <link rel="stylesheet" href="../css/newstudents.css">
    <script src="../js/token-operation.js" type="text/javascript" charset="utf-8"></script>
</head>
<body>
    <div>
        <div class="clear">
            <ul class="layui-nav">
                <li class="layui-nav-item" id="manage-content">
                    <a onclick="manageClicked()">内容管理<span class="layui-nav-item"></span></a>
                </li>
                <li class="layui-nav-item layui-this">
                    <a onclick="userClicked()">用户管理<span class="layui-nav-item"></span></a>
                </li>
                <li class="layui-nav-item">
                    <a onclick="analysisClicked()">统计分析<span class="layui-nav-item"></span></a>
                </li>
                <li class="layui-nav-item" id="my-message">
                    <a href=""><img src="//t.cn/RCzsdCq" class="layui-nav-img">我</a>
                    <dl class="layui-nav-child">
                        <dd><a href="javascript:;">修改信息</a></dd>
                        <dd><a href="javascript:;" onclick="unLoadOnClick()">退出</a></dd>
                    </dl>
                </li>
            </ul>
            <div class="sidebar">
                <ul class="layui-nav layui-nav-tree" lay-filter="test" lay-shrink="all" id="content-manage" style="height: 100vh">
                    <!-- 侧边导航: <ul class="layui-nav layui-nav-tree layui-nav-side"> -->
                    <li class="layui-nav-item">
                        <a href="javascript:;">评分细则管理</a>
                        <dl class="layui-nav-child">
                            <dd><a href="detailList.html">所有细则</a></dd>
                            <!--                        <dd><a href="../performanceManagement/newdetails.html">增加细则</a></dd>-->
                        </dl>
                    </li>
                    <li class="layui-nav-item layui-nav-itemed">
                        <a href="javascript:;">成绩管理</a>
                        <dl class="layui-nav-child">
                            <dd><a href="scoreinquiry.html">成绩查询</a></dd>
                            <!--                    <dd><a href="assignmentScore.html">博客评分</a></dd>-->
                            <dd><a href="blogList.html">博客列表</a></dd>
                        </dl>
                    </li>
                </ul>

                <ul class="layui-nav layui-nav-tree" lay-filter="test" lay-shrink="all" id="user-manage" style="height: 100vh">
                    <!-- 侧边导航: <ul class="layui-nav layui-nav-tree layui-nav-side"> -->
                    <li class="layui-nav-item">
                        <a href="javascript:;">团队管理</a>
                        <dl class="layui-nav-child">
                            <dd><a href="teamList.html">所有团队</a></dd>
                        </dl>
                    </li>
                    <!--                <li class="layui-nav-item">-->
                    <!--                    <a href="javascript:;">结对管理</a>-->
                    <!--                    <dl class="layui-nav-child">-->
                    <!--                        <dd><a href="javascript:;">结对信息</a></dd>-->
                    <!--                        <dd><a href="">增加结对</a></dd>-->
                    <!--                    </dl>-->
                    <!--                </li>-->
                    <li class="layui-nav-item layui-nav-itemed">
                        <a href="javascript:;">学生管理</a>
                        <dl class="layui-nav-child">
                            <dd><a href="studentList2.html">学生列表</a></dd>
                            <dd><a href="newstudents.html" class="layui-this">增加学生</a></dd>
                            <dd><a href="newClasses.html">新建班级</a></dd>
                        </dl>
                    </li>
                    <li class="layui-nav-item">
                        <a href="javascript:;">助教管理</a>
                        <dl class="layui-nav-child">
                            <dd><a href="assistantList.html">助教列表</a></dd>
                            <dd><a href="newAssistant.html">增加助教</a></dd>
                        </dl>
                    </li>
                </ul>

                <ul class="layui-nav layui-nav-tree" lay-filter="test" lay-shrink="all" id="statistical-analysis" style="height: 100vh">
                    <!-- 侧边导航: <ul class="layui-nav layui-nav-tree layui-nav-side"> -->
                    <li class="layui-nav-item  layui-nav-itemed">
                        <a href="javascript:;">统计分析</a>
                        <dl class="layui-nav-child">
                            <dd><a href="">千帆竟发图</a></dd>
                        </dl>
                    </li>
                </ul>
            </div>
        </div>
    
        <div id="message_form">

            <div class="input-group">
                <div style="display: inline">
                    <span class="input-group-addon" >选择班级：</span>
                </div>
                <div style="display: inline">
                    <select id="classId" name="classId" class="layui-select">
                        <option value="">请选择班级</option>
                    </select>
                </div>
            </div>
            <div class="display-inline">
                <div class="input-group">
                    <span class="input-group-addon" id="basic-addon2">评分项上传：</span>
                    <input id="file_upload" type="file" name="file_upload">
                </div>
                <div class="input-group">
                    <button id="down_load_model" onclick="downLoadModel()" class="layui-btn">下载模板</button>
                </div>
            </div>
            
            <button id="jquery_post" class="layui-btn" onclick="onClicked()">提交</button>
        </div>
    </div>
    
<script src="../jquery/dist/jquery.min.js"></script>
<script src="../editormd/editormd.js"></script>
<script src="../editormd/lib/marked.min.js"></script>
<script src="../editormd/lib/prettify.min.js"></script>
<script type="text/javascript">

    document.getElementById("content-manage").style.display="none";
    document.getElementById("user-manage").style.display="block";
    document.getElementById("statistical-analysis").style.display="none";

    function downLoadModel() {
        window.open('http://1.15.129.32:8888/student/export/formwork');
    }

    $(document).ready(function () {
        //加载下拉列表的内容
        $.ajax({
            type: 'post',
            url: 'http://1.15.129.32:8888/score/class/showlist',
            dataType: 'json',
            beforeSend: function (XMLHttpRequest) {
                XMLHttpRequest.setRequestHeader("Token", localStorage.token);
            },
            success: function(data){
                $.each(data.data,function (index,item) {
                    $("#classId").append("<option value='"+data.data[index].id+"'>"+data.data[index].className+"</option>");
                });
            }
        });
    });

    function onClicked() {
        //判断作业名是否为空
        if ($("#classId").val() == ""){
            alert("作业名不能为空！ ");
            return false;
        }

        var $file1 = $("input[name='file_upload']").val();//用户文件内容(文件)
        // 判断文件是否为空
        if ($file1 == "") {
            alert("请选择上传的目标文件! ");
            return false;
        }

        //判断文件类型,我这里根据业务需求判断的是Excel文件
        var fileName1 = $file1.substring($file1.lastIndexOf(".") + 1).toLowerCase();
        if(fileName1 != "xls" && fileName1 !="xlsx"){
            alert("请选择Execl文件!");
            return false;
        }
        3
        //判断文件大小
        var size1 = $("input[name='file_upload']")[0].files[0].size;
        if (size1>104857600) {
            alert("上传文件不能大于100M!");
            return false;
        }

        var form=new FormData();
        var classId = $("#classId").val();
        form.append("excel",$("#file_upload")[0].files[0]);
        form.append("classId",classId);
        $.ajax({
            url:"http://1.15.129.32:8888/student/import",
            type:"POST",
            beforeSend: function (XMLHttpRequest) {
                XMLHttpRequest.setRequestHeader("Token", localStorage.token);
            },
            data:form,
            contentType: false,
            processData: false,
            success:function(data){
                if(data.code == '200'){
                    alert("上传成功！");
                }
            }
        })
    }

</script>
</body>
</html>
